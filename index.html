<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delulu Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Custom range slider styling */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #ec4899;
            cursor: pointer;
            margin-top: -8px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        
        /* Boy mode color overrides */
        body.boy-mode input[type=range]::-webkit-slider-thumb {
            background: #3b82f6; /* Blue-500 */
        }
        body.boy-mode .text-pink-400 { color: #60a5fa !important; }
        body.boy-mode .text-pink-500 { color: #3b82f6 !important; }
        body.boy-mode .text-pink-600 { color: #2563eb !important; }
        body.boy-mode .bg-pink-500 { background-color: #3b82f6 !important; }
        body.boy-mode .bg-pink-100 { background-color: #dbeafe !important; }
        body.boy-mode .bg-pink-50 { background-color: #eff6ff !important; }
        body.boy-mode .focus\:ring-pink-500:focus { --tw-ring-color: #3b82f6 !important; }
        body.boy-mode .border-pink-50 { border-color: #eff6ff !important; }
        body.boy-mode .from-pink-100 { --tw-gradient-from: #dbeafe !important; }
        body.boy-mode .to-indigo-100 { --tw-gradient-to: #e0f2fe !important; }
        body.boy-mode #deluluTitleGradient {
            background-image: linear-gradient(to right, #3b82f6, #6366f1);
        }
        body.boy-mode #calcBtn {
            background-image: linear-gradient(to right, #3b82f6, #4f46e5);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e5e7eb;
            border-radius: 2px;
        }
        .gradient-text {
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Transition for theme switch */
        body, div, span, button, i {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-100 via-purple-100 to-indigo-100 min-h-screen text-slate-800 transition-colors duration-500">

    <!-- Navbar -->
    <nav class="p-4 flex justify-between items-center max-w-4xl mx-auto">
        <div class="flex items-center space-x-2">
            <i class="fa-solid fa-heart-crack text-pink-500 text-2xl" id="navIcon"></i>
            <h1 class="text-2xl font-extrabold tracking-tight">Delulu<span class="text-pink-500">Meter</span></h1>
        </div>
        <div class="text-sm font-semibold text-slate-500">US Edition ðŸ‡ºðŸ‡¸</div>
    </nav>

    <!-- Main Container -->
    <main class="max-w-xl mx-auto px-4 pb-20">
        
        <!-- Header -->
        <div class="text-center my-8">
            <h2 id="deluluTitleGradient" class="text-4xl font-black mb-2 bg-gradient-to-r from-pink-500 to-violet-600 gradient-text">How picky are you?</h2>
            <p class="text-slate-500">Select your ideal partner's traits to calculate your reality check.</p>
        </div>

        <!-- Gender Tabs -->
        <div class="flex bg-white p-1 rounded-xl shadow-sm mb-8">
            <button onclick="setGender('female')" id="tabFemale" class="flex-1 py-2 rounded-lg bg-pink-500 text-white font-bold shadow-md transition-all">
                <i class="fa-solid fa-venus mr-2"></i>Girl
            </button>
            <button onclick="setGender('male')" id="tabMale" class="flex-1 py-2 rounded-lg text-slate-400 font-bold hover:bg-slate-50 transition-all">
                <i class="fa-solid fa-mars mr-2"></i>Boy
            </button>
        </div>

        <!-- Form Area -->
        <div class="bg-white rounded-3xl shadow-xl p-6 space-y-8 border border-pink-50">

            <!-- Age Range -->
            <div class="space-y-3">
                <div class="flex justify-between items-end">
                    <label class="font-bold text-slate-700"><i class="fa-solid fa-cake-candles w-6 text-pink-400"></i> Age Range</label>
                    <span class="text-pink-600 font-mono font-bold text-sm bg-pink-50 px-2 py-1 rounded" id="ageDisplay">18 - 40</span>
                </div>
                <div class="relative pt-1">
                    <input type="range" id="minAge" min="18" max="80" value="18" class="absolute w-full z-20 opacity-0 cursor-pointer" oninput="updateAge()">
                    <input type="range" id="maxAge" min="18" max="80" value="40" class="absolute w-full z-20 opacity-0 cursor-pointer" oninput="updateAge()">
                    <div class="h-1 bg-gray-200 rounded-full w-full absolute top-2"></div>
                    <div id="ageTrack" class="h-1 bg-pink-500 rounded-full absolute top-2"></div>
                </div>
                <div class="h-4"></div>
            </div>

            <!-- Marital Status -->
            <div class="space-y-3">
                <label class="font-bold text-slate-700 flex items-center">
                    <i class="fa-solid fa-ring w-6 text-pink-400"></i> Must be Unmarried?
                    <input type="checkbox" id="unmarriedOnly" class="ml-auto w-5 h-5 text-pink-600 rounded focus:ring-pink-500 border-gray-300" checked>
                </label>
                <p class="text-xs text-slate-400" id="marriageNote">Excludes married stats (approx. 47% of US women).</p>
            </div>

            <hr class="border-slate-100">

            <!-- Height -->
            <div class="space-y-3">
                <div class="flex justify-between items-end">
                    <label class="font-bold text-slate-700"><i class="fa-solid fa-ruler-vertical w-6 text-pink-400"></i> Minimum Height</label>
                    <span class="text-pink-600 font-mono font-bold text-sm bg-pink-50 px-2 py-1 rounded" id="heightDisplay">Any</span>
                </div>
                <!-- Default ranges will be updated by JS -->
                <input type="range" id="minHeight" min="54" max="78" value="54" class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                <div class="flex justify-between text-xs text-slate-400 px-1" id="heightLabels">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Race -->
            <div class="space-y-3">
                <label class="font-bold text-slate-700"><i class="fa-solid fa-earth-americas w-6 text-pink-400"></i> Race preference</label>
                <select id="race" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500 text-slate-700">
                    <option value="any">Any Race (Open to all)</option>
                    <option value="white">White / Caucasian</option>
                    <option value="black">Black / African American</option>
                    <option value="hispanic">Hispanic / Latino</option>
                    <option value="asian">Asian</option>
                </select>
            </div>

            <!-- Hair Color -->
            <div class="space-y-3">
                <label class="font-bold text-slate-700"><i class="fa-solid fa-palette w-6 text-pink-400"></i> Hair Color</label>
                <select id="hair" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500 text-slate-700">
                    <option value="any">Any Color</option>
                    <option value="blonde">Blonde</option>
                    <option value="black">Black</option>
                    <option value="brown">Brown</option>
                    <option value="red">Red / Ginger</option>
                </select>
            </div>

             <!-- Eye Color -->
             <div class="space-y-3">
                <label class="font-bold text-slate-700"><i class="fa-solid fa-eye w-6 text-pink-400"></i> Eye Color</label>
                <select id="eye" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500 text-slate-700">
                    <option value="any">Any Color</option>
                    <option value="brown">Brown</option>
                    <option value="blue">Blue</option>
                    <option value="hazel">Hazel</option>
                    <option value="green">Green</option>
                </select>
            </div>

            <hr class="border-slate-100">

            <!-- Body Type / Obesity -->
            <div class="space-y-3">
                <label class="font-bold text-slate-700"><i class="fa-solid fa-person w-6 text-pink-400"></i> Max Body Size</label>
                <select id="bodyType" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500 text-slate-700">
                    <option value="any">Any (I don't care)</option>
                    <option value="obese">No Obese (BMI < 30)</option>
                    <option value="overweight">No Overweight (BMI < 25)</option>
                    <option value="underweight">Slim / Fit Only</option>
                </select>
            </div>

            <!-- FEMALE SPECIFIC: Breast Size -->
            <div id="femaleSpecifics" class="space-y-3">
                <label class="font-bold text-slate-700"><i class="fa-solid fa-heart w-6 text-pink-400"></i> Min Cup Size</label>
                <select id="cupSize" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500 text-slate-700">
                    <option value="any">Any Size</option>
                    <option value="B">At least B Cup</option>
                    <option value="C">At least C Cup</option>
                    <option value="D">At least D Cup</option>
                    <option value="DD">DD+ (Very Rare if Slim)</option>
                </select>
            </div>

            <!-- MALE SPECIFIC: Salary & Facial Hair -->
            <div id="maleSpecifics" class="space-y-8 hidden">
                <!-- Salary -->
                <div class="space-y-3">
                    <div class="flex justify-between items-end">
                        <label class="font-bold text-slate-700"><i class="fa-solid fa-money-bill-wave w-6 text-pink-400"></i> Min Salary</label>
                        <span class="text-pink-600 font-mono font-bold text-sm bg-pink-50 px-2 py-1 rounded" id="salaryDisplay">Any</span>
                    </div>
                    <input type="range" id="minSalary" min="0" max="100" value="0" step="5" class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    <div class="flex justify-between text-xs text-slate-400 px-1">
                        <span>$0k</span>
                        <span>$50k</span>
                        <span>$100k</span>
                        <span>$250k+</span>
                    </div>
                </div>

                <!-- Facial Hair -->
                <div class="space-y-3">
                    <label class="font-bold text-slate-700"><i class="fa-solid fa-user-astronaut w-6 text-pink-400"></i> Facial Hair</label>
                    <select id="facialHair" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500 text-slate-700">
                        <option value="any">Any</option>
                        <option value="clean">Clean Shaven</option>
                        <option value="beard">Beard / Stubble</option>
                        <option value="mustache">Mustache Only</option>
                    </select>
                </div>
            </div>

            <!-- Calculate Button -->
            <button id="calcBtn" onclick="calculateDelulu()" class="w-full py-4 bg-gradient-to-r from-pink-500 to-rose-600 text-white font-black text-xl rounded-2xl shadow-lg hover:shadow-pink-500/30 transform hover:scale-[1.02] transition-all active:scale-95">
                CALCULATE DELULU
            </button>
        </div>
    </main>

    <!-- Result Modal (Hidden by default) -->
    <div id="resultModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-md rounded-3xl p-6 shadow-2xl relative animate-bounce-in">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600">
                <i class="fa-solid fa-xmark text-2xl"></i>
            </button>

            <div class="text-center space-y-4">
                <div class="inline-block p-4 rounded-full bg-pink-100 mb-2">
                    <i id="resultIcon" class="fa-solid fa-cat text-4xl text-pink-500"></i>
                </div>
                
                <h3 class="text-3xl font-black text-slate-800" id="deluluLevel">Delusional</h3>
                
                <div class="bg-slate-50 rounded-xl p-4 border border-slate-100">
                    <div class="text-sm text-slate-500 mb-1">Probability of finding match</div>
                    <div class="text-4xl font-mono font-bold text-pink-600" id="probabilityResult">0.00%</div>
                    <div class="text-xs text-slate-400 mt-2">1 in <span id="oneInX">1000</span> people</div>
                </div>

                <div class="space-y-2">
                    <div class="text-sm font-semibold text-slate-700">Delulu Score</div>
                    <div class="h-4 bg-gray-200 rounded-full overflow-hidden">
                        <div id="deluluBar" class="h-full bg-gradient-to-r from-green-400 via-yellow-400 to-red-500 w-0 transition-all duration-1000"></div>
                    </div>
                    <div class="flex justify-between text-xs text-slate-400 font-mono">
                        <span>Realist</span>
                        <span>Dreamer</span>
                        <span>Delulu</span>
                    </div>
                </div>

                <p id="resultComment" class="text-slate-600 text-sm italic">
                    "You might want to lower your standards or buy a cat."
                </p>

                <button onclick="closeModal()" class="w-full py-3 bg-slate-800 text-white font-bold rounded-xl mt-4">
                    Try Again
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- STATE ---
        let currentGender = 'female'; // 'female' or 'male'

        // --- DATA & CONSTANTS ---
        const FEMALE_STATS = {
            race: { 'white': 0.59, 'black': 0.13, 'hispanic': 0.19, 'asian': 0.06, 'any': 1.0 },
            marriage: { '18-29': 0.70, '30-39': 0.40, '40-49': 0.35, '50+': 0.45 }, // % Single
            hair: {
                'blonde': { 'white': 0.25, 'other': 0.02 },
                'black': { 'white': 0.15, 'black': 0.95, 'asian': 0.95, 'hispanic': 0.60 },
                'brown': { 'white': 0.50, 'black': 0.04, 'asian': 0.04, 'hispanic': 0.35 },
                'red': { 'white': 0.04, 'other': 0.01 },
                'any': { 'white': 1, 'other': 1 }
            },
            eyes: { 'brown': 0.50, 'blue': 0.25, 'hazel': 0.15, 'green': 0.10, 'any': 1.0 },
            bmi: { 'any': 1.0, 'obese': 0.58, 'overweight': 0.29, 'underweight': 0.05 },
            heightMean: 63.7, heightSD: 2.7,
            cups: { 'any': 1.0, 'B': 0.85, 'C': 0.60, 'D': 0.35, 'DD': 0.15 }
        };

        const MALE_STATS = {
            race: { 'white': 0.61, 'black': 0.12, 'hispanic': 0.19, 'asian': 0.06, 'any': 1.0 },
            marriage: { '18-29': 0.80, '30-39': 0.45, '40-49': 0.30, '50+': 0.30 }, // Men marry later
            hair: {
                'blonde': { 'white': 0.20, 'other': 0.01 }, // Men dye hair less
                'black': { 'white': 0.15, 'black': 0.95, 'asian': 0.95, 'hispanic': 0.60 },
                'brown': { 'white': 0.55, 'black': 0.04, 'asian': 0.04, 'hispanic': 0.35 },
                'red': { 'white': 0.04, 'other': 0.01 },
                'any': { 'white': 1, 'other': 1 }
            },
            eyes: { 'brown': 0.50, 'blue': 0.25, 'hazel': 0.15, 'green': 0.10, 'any': 1.0 },
            bmi: { 'any': 1.0, 'obese': 0.60, 'overweight': 0.26, 'underweight': 0.02 }, // Men are heavier on avg
            heightMean: 69.1, heightSD: 2.9,
            facial: { 'any': 1.0, 'clean': 0.40, 'beard': 0.50, 'mustache': 0.05 },
            // Salary: Cumulative Percentile of Individual Income (Approx 2024)
            // Value is % of men earning MORE than amount
            salary: [
                { val: 0, p: 1.00 },
                { val: 25000, p: 0.85 },
                { val: 50000, p: 0.60 },
                { val: 75000, p: 0.40 },
                { val: 100000, p: 0.18 }, // The 6-fig killer
                { val: 150000, p: 0.08 },
                { val: 250000, p: 0.03 },
                { val: 500000, p: 0.01 }
            ]
        };

        // --- UI LOGIC ---

        function setGender(gender) {
            currentGender = gender;
            const body = document.body;
            const femaleBtn = document.getElementById('tabFemale');
            const maleBtn = document.getElementById('tabMale');
            const femaleSpecs = document.getElementById('femaleSpecifics');
            const maleSpecs = document.getElementById('maleSpecifics');
            const marriageNote = document.getElementById('marriageNote');
            const navIcon = document.getElementById('navIcon');

            if (gender === 'male') {
                // Style updates
                body.classList.add('boy-mode');
                
                // Tabs
                maleBtn.classList.remove('text-slate-400', 'hover:bg-slate-50');
                maleBtn.classList.add('bg-pink-500', 'text-white', 'shadow-md'); // bg-pink-500 is overridden by CSS to be blue
                
                femaleBtn.classList.remove('bg-pink-500', 'text-white', 'shadow-md');
                femaleBtn.classList.add('text-slate-400', 'hover:bg-slate-50');

                // Content
                femaleSpecs.classList.add('hidden');
                maleSpecs.classList.remove('hidden');
                marriageNote.innerText = "Excludes married stats (approx. 51% of US men).";
                navIcon.className = "fa-solid fa-mars-double text-pink-500 text-2xl"; // Icon changes

                // Height Slider adjustments for men (taller)
                const hSlider = document.getElementById('minHeight');
                hSlider.min = 60; // 5'0"
                hSlider.max = 80; // 6'8"
                hSlider.value = 60;
                document.getElementById('heightLabels').innerHTML = `
                    <span>5'0"</span>
                    <span>5'6"</span>
                    <span>6'0"</span>
                    <span>6'6"+</span>
                `;
                document.getElementById('heightDisplay').innerText = "Any";

            } else {
                // Style updates
                body.classList.remove('boy-mode');
                
                // Tabs
                femaleBtn.classList.remove('text-slate-400', 'hover:bg-slate-50');
                femaleBtn.classList.add('bg-pink-500', 'text-white', 'shadow-md');
                
                maleBtn.classList.remove('bg-pink-500', 'text-white', 'shadow-md');
                maleBtn.classList.add('text-slate-400', 'hover:bg-slate-50');

                // Content
                maleSpecs.classList.add('hidden');
                femaleSpecs.classList.remove('hidden');
                marriageNote.innerText = "Excludes married stats (approx. 47% of US women).";
                navIcon.className = "fa-solid fa-heart-crack text-pink-500 text-2xl";

                // Height Slider adjustments for women
                const hSlider = document.getElementById('minHeight');
                hSlider.min = 54;
                hSlider.max = 72;
                hSlider.value = 54;
                document.getElementById('heightLabels').innerHTML = `
                    <span>4'6"</span>
                    <span>5'0"</span>
                    <span>5'6"</span>
                    <span>6'0"+</span>
                `;
                document.getElementById('heightDisplay').innerText = "Any";
            }
        }

        // Height Slider Display
        const heightSlider = document.getElementById('minHeight');
        const heightDisplay = document.getElementById('heightDisplay');
        
        heightSlider.addEventListener('input', (e) => {
            const val = parseInt(e.target.value);
            const minVal = parseInt(heightSlider.min);
            
            if (val <= minVal) {
                heightDisplay.innerText = "Any";
            } else {
                const ft = Math.floor(val / 12);
                const inch = val % 12;
                heightDisplay.innerText = `${ft}'${inch}"+`;
            }
        });

        // Salary Slider Logic (Logarithmic-ish visual mapping)
        const salarySlider = document.getElementById('minSalary');
        const salaryDisplay = document.getElementById('salaryDisplay');
        
        // Map 0-100 slider range to dollar values
        function getSalaryFromSlider(val) {
            if (val <= 0) return 0;
            if (val <= 20) return val * 1250; // 0-25k
            if (val <= 40) return 25000 + (val - 20) * 1250; // 25k-50k
            if (val <= 60) return 50000 + (val - 40) * 2500; // 50k-100k
            if (val <= 80) return 100000 + (val - 60) * 5000; // 100k-200k
            return 200000 + (val - 80) * 15000; // 200k-500k+
        }

        salarySlider.addEventListener('input', (e) => {
            const val = parseInt(e.target.value);
            const dollars = getSalaryFromSlider(val);
            
            if (dollars <= 0) {
                salaryDisplay.innerText = "Any";
            } else if (dollars >= 500000) {
                salaryDisplay.innerText = "$500k+";
            } else {
                // Format K
                salaryDisplay.innerText = "$" + (dollars / 1000).toFixed(0) + "k+";
            }
        });

        // Age Dual Slider
        function updateAge() {
            let slide1 = parseInt(document.getElementById("minAge").value);
            let slide2 = parseInt(document.getElementById("maxAge").value);

            if (slide1 > slide2) {
                let tmp = slide1; 
                slide1 = slide2; 
                slide2 = tmp;
            }
            
            document.getElementById("ageDisplay").innerHTML = `${slide1} - ${slide2}`;
            
            // Visual track update
            const min = 18, max = 80;
            const percent1 = ((slide1 - min) / (max - min)) * 100;
            const percent2 = ((slide2 - min) / (max - min)) * 100;
            const track = document.getElementById("ageTrack");
            track.style.left = percent1 + "%";
            track.style.width = (percent2 - percent1) + "%";
        }
        updateAge(); // init
        setGender('female'); // init default

        // --- CALCULATION LOGIC ---

        function getNormalProbability(x, mean, stdDev) {
            // Returns P(X > x) for normal distribution
            const z = (x - mean) / stdDev;
            if (z < -5.0) return 1.0;
            if (z > 5.0) return 0.0;
            let t = 1 / (1 + 0.2316419 * Math.abs(z));
            let d = 0.3989423 * Math.exp(-z * z / 2);
            let p = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
            if (z > 0) p = 1 - p;
            return 1 - p; 
        }

        function calculateDelulu() {
            // 1. Get Common Inputs
            const minAge = Math.min(parseInt(document.getElementById("minAge").value), parseInt(document.getElementById("maxAge").value));
            const maxAge = Math.max(parseInt(document.getElementById("minAge").value), parseInt(document.getElementById("maxAge").value));
            const race = document.getElementById("race").value;
            const hair = document.getElementById("hair").value;
            const eye = document.getElementById("eye").value;
            const height = parseInt(document.getElementById("minHeight").value);
            const body = document.getElementById("bodyType").value;
            const unmarried = document.getElementById("unmarriedOnly").checked;
            
            // Select Dataset
            const STATS = currentGender === 'female' ? FEMALE_STATS : MALE_STATS;

            // 2. Start Probability
            let prob = 1.0;

            // 3. Apply Factors

            // Race
            const raceProb = STATS.race[race];
            prob *= raceProb;

            // Height (Normal Dist)
            const minH = parseInt(document.getElementById("minHeight").min);
            if (height > minH) {
                const heightProb = getNormalProbability(height, STATS.heightMean, STATS.heightSD);
                prob *= heightProb;
            }

            // Hair (Conditional on Race)
            let hairProb = 1.0;
            if (hair !== 'any') {
                if (race === 'any') {
                    hairProb = 
                        (STATS.hair[hair].white * STATS.race.white) +
                        (STATS.hair[hair].black * STATS.race.black) +
                        (STATS.hair[hair].asian * STATS.race.asian) +
                        (STATS.hair[hair].hispanic * STATS.race.hispanic);
                } else {
                    let specificProb = STATS.hair[hair][race];
                    if (specificProb === undefined) specificProb = STATS.hair[hair]['other'];
                    // Simple overrides for race-specific hair logic if needed
                    if (race === 'hispanic' && STATS.hair[hair]['hispanic']) specificProb = STATS.hair[hair]['hispanic'];
                    hairProb = specificProb;
                }
            }
            prob *= hairProb;

            // Eye Color
            if (eye !== 'any') {
                if (race === 'any') {
                    prob *= STATS.eyes[eye];
                } else if (race === 'white') {
                    if (eye === 'blue') prob *= 0.40;
                    else if (eye === 'brown') prob *= 0.30;
                    else prob *= 0.15;
                } else {
                    if (eye === 'brown') prob *= 0.90;
                    else prob *= 0.03; 
                }
            }

            // Body Type
            prob *= STATS.bmi[body];

            // Gender Specifics
            if (currentGender === 'female') {
                // Cup Size
                const cup = document.getElementById("cupSize").value;
                let cupProb = STATS.cups[cup];
                // Correlation Adjustments
                if (body === 'underweight' && (cup === 'D' || cup === 'DD')) cupProb *= 0.1; 
                else if (body === 'overweight' || body === 'obese') {
                    if (cup === 'D' || cup === 'DD') cupProb *= 1.5;
                    if (cupProb > 1) cupProb = 1;
                }
                prob *= cupProb;

            } else {
                // Male Specifics: Salary
                const salarySliderVal = parseInt(document.getElementById("minSalary").value);
                const salaryDollars = getSalaryFromSlider(salarySliderVal);
                if (salaryDollars > 0) {
                    // Find bracket
                    const brackets = STATS.salary;
                    let salaryProb = 0.01; // default if higher than max
                    for (let i = 0; i < brackets.length; i++) {
                        if (salaryDollars <= brackets[i].val) {
                            salaryProb = brackets[i-1] ? brackets[i-1].p : 1.0; // Interpolation could happen here, but steps are fine
                             // Simple Linear Interpolation between brackets
                            if (i > 0) {
                                const prev = brackets[i-1];
                                const next = brackets[i];
                                const range = next.val - prev.val;
                                const percentInRange = (salaryDollars - prev.val) / range;
                                salaryProb = prev.p - (percentInRange * (prev.p - next.p));
                            }
                            break;
                        }
                    }
                    if (salaryDollars >= 500000) salaryProb = 0.01;
                    prob *= salaryProb;
                }

                // Male Specifics: Facial Hair
                const facial = document.getElementById("facialHair").value;
                prob *= STATS.facial[facial];
            }

            // Marital Status
            if (unmarried) {
                const avgAge = (minAge + maxAge) / 2;
                let singleRate = 0.45;
                if (avgAge < 30) singleRate = STATS.marriage['18-29'];
                else if (avgAge < 40) singleRate = STATS.marriage['30-39'];
                else if (avgAge < 50) singleRate = STATS.marriage['40-49'];
                else singleRate = STATS.marriage['50+'];
                prob *= singleRate;
            }
            
            // Age Slice
            const totalYears = 80 - 18;
            const rangeYears = maxAge - minAge;
            const ageSlice = Math.max(rangeYears, 1) / totalYears; 
            prob *= ageSlice;

            // 4. Display Results
            showResult(prob);
        }

        function showResult(probability) {
            const modal = document.getElementById('resultModal');
            const percentDisplay = document.getElementById('probabilityResult');
            const oneInXDisplay = document.getElementById('oneInX');
            const deluluText = document.getElementById('deluluLevel');
            const icon = document.getElementById('resultIcon');
            const comment = document.getElementById('resultComment');
            const bar = document.getElementById('deluluBar');

            if (probability < 0.000001) probability = 0.0000001;
            
            let percentStr = (probability * 100).toFixed(4) + "%";
            if (probability > 0.01) percentStr = (probability * 100).toFixed(2) + "%";
            
            let oneInX = Math.round(1 / probability);
            if (oneInX > 1000000) oneInX = "1 Million+";
            else oneInX = oneInX.toLocaleString();

            let score = 0;
            let level = "";
            let iconClass = "";
            let msg = "";
            
            if (probability > 0.1) {
                score = 10;
                level = "Realistic";
                iconClass = "fa-regular fa-face-smile text-green-500";
                msg = "You have reasonable standards. Go get 'em!";
            } else if (probability > 0.01) {
                score = 30;
                level = "Pickier than Average";
                iconClass = "fa-regular fa-face-meh text-yellow-500";
                msg = "A bit selective, but definitely possible.";
            } else if (probability > 0.001) {
                score = 60;
                level = "Delusional";
                iconClass = "fa-solid fa-cloud-moon text-orange-500";
                msg = "You're looking for a needle in a haystack.";
            } else if (probability > 0.0001) {
                score = 85;
                level = "Terminally Delulu";
                iconClass = "fa-solid fa-skull text-red-500";
                msg = "You are statistically likely to die alone.";
            } else {
                score = 100;
                level = "Get Therapy";
                iconClass = "fa-solid fa-cat text-purple-600";
                msg = "This person does not exist. Buy a cat.";
            }

            percentDisplay.innerText = percentStr;
            oneInXDisplay.innerText = oneInX;
            deluluText.innerText = level;
            icon.className = iconClass + " text-4xl";
            comment.innerText = `"${msg}"`;
            
            modal.classList.remove('hidden');
            setTimeout(() => { bar.style.width = score + "%"; }, 100);
        }

        function closeModal() {
            document.getElementById('resultModal').classList.add('hidden');
            document.getElementById('deluluBar').style.width = "0%";
        }

    </script>
</body>
</html>
